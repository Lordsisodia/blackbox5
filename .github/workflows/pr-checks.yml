# ============================================================================
# BLACKBOX5 - PULL REQUEST CHECKS
# ============================================================================
# Purpose: Quick validation on PRs - fast feedback for developers
# Trigger: Pull request events
# ============================================================================

name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  # ========================================================================
  # VALIDATE PR TITLE
  # ========================================================================
  pr-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title format
        uses: amannn/action-semantic-pull-request@v6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            style
            refactor
            test
            chore
            ci
            perf
            security
          requireScope: false

  # ========================================================================
  # CHECK FILE SIZE
  # ========================================================================
  file-size:
    name: Check File Sizes
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for large files
        run: |
          echo "Checking for files larger than 1MB..."
          find . -type f -size +1M \
            ! -path './.git/*' \
            ! -path './.pytest_cache/*' \
            ! -path '__pycache__/*' \
            ! -name '*.png' \
            ! -name '*.jpg' \
            ! -name '*.gif' \
            -exec ls -lh {} \; | awk '{ print $9 ": " $5 }'
        continue-on-error: true

  # ========================================================================
  # QUICK SMOKE TEST
  # ========================================================================
  smoke:
    name: Quick Smoke Test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: Install minimal dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml click

      - name: Validate YAML files
        run: |
          find . -name '*.yml' -o -name '*.yaml' | \
            grep -v '.git' | \
            grep -v '__pycache__' | \
            while read f; do
              python -c "import yaml; yaml.safe_load(open('$f'))" 2>/dev/null || echo "Invalid YAML: $f"
            done
        continue-on-error: true

      - name: Check Python syntax
        run: |
          find 2-engine -name '*.py' | head -20 | \
            while read f; do
              python -m py_compile "$f" 2>/dev/null || echo "Syntax error: $f"
            done
        continue-on-error: true
