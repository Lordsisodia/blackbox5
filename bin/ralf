#!/bin/bash
# RALF - Run from blackbox5 root
# Usage: ./ralf [project-name]
# Example: ./ralf ralf-core

# Resolve blackbox5 root (script is in bin/ subdirectory)
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
BLACKBOX5_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"
PROJECT_NAME="${1:-blackbox5}"

# Validate project exists
PROJECT_DIR="$BLACKBOX5_DIR/5-project-memory/$PROJECT_NAME"
if [ ! -d "$PROJECT_DIR/.autonomous" ]; then
    echo "Error: Project '$PROJECT_NAME' not found"
    echo "Available projects:"
    ls "$BLACKBOX5_DIR/5-project-memory/"
    exit 1
fi

ENGINE_DIR="$BLACKBOX5_DIR/2-engine/.autonomous"

# Export for RALF
export RALF_BLACKBOX5_DIR="$BLACKBOX5_DIR"
export RALF_PROJECT_DIR="$PROJECT_DIR"
export RALF_ENGINE_DIR="$ENGINE_DIR"

echo "╔════════════════════════════════════════════════════════════╗"
echo "║  RALF Autonomous System                                    ║"
echo "║  Blackbox5: $BLACKBOX5_DIR"
echo "║  Project: $PROJECT_NAME"
echo "╚════════════════════════════════════════════════════════════╝"
echo ""

# Run RALF
exec "$ENGINE_DIR/shell/ralf-loop.sh" "$PROJECT_DIR"
